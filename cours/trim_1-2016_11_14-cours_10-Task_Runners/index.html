<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>TRIM 1 - Cours 10 - Task Runners</title>
        <meta name="description" content="">
        <meta name="author" content="Bruno Simon">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="../src/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../src/reveal.js/css/theme/orange.css" id="theme">
        <link rel="stylesheet" href="../src/reveal.js/lib/css/highlight/railscasts.css">
        <!-- <link rel="stylesheet" href="../src/reveal.js/lib/css/highlight/github.css"> -->
        <link rel="stylesheet" href="../src/custom/style.css">
        <script>
            document.write( '<link rel="stylesheet" href="../src/reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>
        <!--[if lt IE 9]>
            <script src="../src/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section>
                    <h3>H2 - P2020</h3>
                    <h1>Développement web</h1>
                    <h3>Cours 10 - 2016-11-14</h3>
                    <ul>
                        <li>github : <a target="_blank" href="https://github.com/brunosimon/hetic-p2020">https://github.com/brunosimon/hetic-p2020</a></li>
                        <li>site : <a target="_blank" href="http://bruno-simon.com/hetic/p2020/">http://bruno-simon.com/hetic/p2020/</a></li>
                        <li>contact : <a target="_blank" mailto="bruno.simon@hetic.net">bruno.simon@hetic.net</a></li>
                    </ul>
                </section>

                <!-- PRESENTATION -->
                <section>
                    <h1>Task Runners</h1>
                </section>

                <section>
                    <p>Pour optimiser un site, il faut compresser les images, concaténer et optimiser le JS, minimifier et préfixer le CSS, etc.</p>
                    <p>Tout faire à manuellement est contre productif.</p>
                    <p>Les task runners sont des scripts permettant d'automatiser ces actions.</p>
                </section>

                <section>
                    <p>En opposition, il existe des logiciels qui peuvent s'occuper de certaines tâches.</p>
                    <p>L'avantage d'un task runner par rapport à un logiciel est que n'importe quel développeur qui récupère le projet n'a qu'à lancer le task runner pour que les tâches s'accomplissent automatiquement.</p>
                    <p>Idéal pour un travail en équipe.</p>
                </section>

                <section>
                    <p>Il en existe plusieurs :</p>
                    <ul>
                        <li><a href="http://gulpjs.com/" target="_blank">Gulp</a></li>
                        <li><a href="http://gruntjs.com/" target="_blank">Grunt</a></li>
                        <li><a href="http://broccolijs.com/" target="_blank">Broccoli</a></li>
                        <li><a href="http://mimosa.io/index.html" target="_blank">Mimosa</a></li>
                        <li><a href="https://webpack.github.io/" target="_blank">Webpack</a></li>
                        <li>...</li>
                    </ul>
                </section>

                <section>
                    <p>Chacun possède ses propres critères :</p>
                    <ul>
                        <li>Performance</li>
                        <li>Facilité</li>
                        <li>Modulabilité</li>
                        <li>Compatibilité</li>
                        <li>Quantité et qualité des tasks</li>
                        <li>...</li>
                    </ul>
                </section>

                <section>
                    <p>À vous de décider lequel choisir</p>
                    <p>Dans le cadre du cours, nous allons utiliser <a href="http://gulpjs.com/" target="_blank">Gulp</a></p>
                    <img class="no-style" src="src/img/gulp.svg" alt="">
                    <p>Très répandu, facile à mettre en place, moyennement facile à configurer, modulable et possède un très large pannel de tasks</p>
                </section>

                <!-- NODE.JS -->
                <section>
                    <h2>Node.JS</h2>
                </section>

                <section>
                    <p>Gulp, comme les autres task runners, utilise <a href="https://nodejs.org/en/" target="_blank">Node.JS</a></p>
                    <p>Node.JS permet d'executer du javascript ailleurs que dans le navigateur afin d'accomplir des actions variés</p>
                    <p>Aujourd'hui, Node.js est utilisé pour faire tourner des sites, des jeux, des tasks runners, des installations digitales, etc.</p>
                </section>

                <section>
                    <p>Télécharger et installez la dernière version (Windows/OSX) :</p>
                    <p><a href="https://nodejs.org/en/" target="_blank">https://nodejs.org/en/</a></p>
                </section>

                <!-- TERMINAL -->
                <section>
                    <h2>Terminal</h2>
                </section>

                <section>
                    <p>Pour pouvoir utiliser les fonctionnalités de la suite du cours, nous allons utiliser le Terminal</p>
                    <p>Sur Mac, recherchez simplement l'application <span class="hl">Terminal</span></p>
                    <p>
                        <img src="src/img/search-terminal.png" alt="" width="550">
                    </p>
                </section>

                <section>
                    <p>Voici votre terminal</p>
                    <p>
                        <img class="no-style" src="src/img/terminal.png" alt="" width="600">
                        <br>Celui-ci fonctionne avec les commandes unix que nous allons voir plus tard
                    </p>
                </section>

                <section>
                    <p>Alternatives :</p>
                    <ul>
                        <li><a href="https://www.iterm2.com/" target="_blank">iTerm2</a></li>
                        <li><a href="https://hyper.is/" target="_blank">Hyper</a></li>
                    </ul>
                </section>

                <section>
                    <p>Sur PC<span class="fragment">, bonne chance</span></p>
                </section>

                <section>
                    <p>Sur PC, utilisez l'<span class="hl">Invite de commandes</span></p>
                    <p>Afin de faire fonctionner les commandes unix, installez <a href="https://github.com/bmatzelle/gow/releases" target="_blank">Gow</a></p>
                </section>

                <section>
                    <p>Nous allons voir qu'une infime partie des commandes unix séparées en 3 groupes</p>
                    <ul>
                        <li>Primordiales</li>
                        <li>Pratiques</li>
                        <li>Bonus</li>
                    </ul>
                </section>

                <section>
                    <h3>Commandes primodiales</h3>

                    <ul>
                        <li>
                            <span class="hl">pwd</span> : afficher le chemin du dossier courant
                            <pre><code data-trim contenteditable class="cpp">
pwd
                            </code></pre>
                        </li>
                        <li>
                            <span class="hl">ls</span> : afficher les fichiers et dossiers dans le dossier courant
                            <pre><code data-trim contenteditable class="cpp">
ls
                            </code></pre>
                        </li>
                        <li>
                            <span class="hl">cd</span> : se déplacer dans un dossier
                            <pre><code data-trim contenteditable class="cpp">
cd dossier-1/dossier-2
cd ../..
                            </code></pre>
                        </li>
                    </ul>

                </section>

                <section>
                    <h3>Commandes pratiques</h3>

                    <ul>
                        <li>
                            <span class="hl">clear</span> : effacer le contenu du terminal
                            <pre><code data-trim contenteditable class="cpp">
clear
                            </code></pre>
                        </li>
                        <li>
                            <span class="hl">man</span> : afficher le manuel d'une commande (<span class="hl">Q</span> pour quitter)
                            <pre><code data-trim contenteditable class="cpp">
man clear
                            </code></pre>
                        </li>
                        <li>
                            <span class="hl">open</span> : ouvrir un dossier dans le finder
                            <pre><code data-trim contenteditable class="cpp">
open ./
open dossier-1
                            </code></pre>
                        </li>
                    </ul>

                </section>

                <section>
                    <h3>Commandes pratiques</h3>

                    <ul>
                        <li><span class="hl">touch</span> : créer un fichier</li>
                        <li><span class="hl">cp</span> : copier un fichier ou dossier</li>
                        <li><span class="hl">mv</span> : déplacer un fichier ou dossier</li>
                        <li><span class="hl">mkdir</span> : créer un dossier</li>
                        <li><span class="hl">rm</span> : supprimer un fichier</li>
                        <li><span class="hl">rmdir</span> : supprimer un dossier</li>
                        <li><span class="hl">vim</span> : éditer un fichier avec Vim</li>
                        <li>
                            <span class="hl">say</span> : faire parler votre ordinateur
                            <pre><code data-trim contenteditable class="cpp">
say "Coucou la famille"
                            </code></pre>
                        </li>
                    </ul>

                </section>

                <section>
                    <h3>Astuces</h3>

                    <ul>
                        <li>Sur Mac, vous pouvez créer des onglets avec <span class="hl">CMD + T</span></li>
                        <li>Pour ne pas avoir à écrire un chemin entier, glissez/déposez le dossier depuis le finder dans le terminal</li>
                        <li>Quand vous écrivez le nom d'un fichier ou dossier, tapez la touche <span class="hl">TAB</span> pour auto-compléter</li>
                        <li>Utilisez les flèches haut et bas pour naviguer dans l'historique des commandes</li>
                    </ul>
                </section>

                <!-- NPM -->
                <section>
                    <h2>NPM</h2>
                </section>

                <section>
                    <p>Les scripts nodes sont appelés <span class="u">packages</span> ou <span class="u">modules</span>. Dans le cadre d'un projet, on parle aussi de <span class="u">dépendances</span></p>
                    <p>Il en existe des dizaines de milliers que l'on peut retrouver le site <a href="http://www.npmjs.com" target="_blank">www.npmjs.com</a></p>
                    <p>NPM : Node Package Manager</p>
                </section>

                <section>
                    <p>En installant Node.js, on a aussi installé NPM que l'on peut utiliser depuis le terminal</p>
                    <p>Nous allons prendre comme exemple le package <a href="https://www.npmjs.com/package/gulp-cssnano" target="_blank">gulp-cssnano</a> qui nous permettra plus tard de compresser notre CSS</p>
                    <p>Pour installer le package depuis le terminal, on peut écrire</p>
                    <pre><code data-trim contenteditable class="cpp">
npm install gulp-cssnano
                    </code></pre>
                </section>

                <section>
                    <p>Un dossier <span class="hl">node_modules</span> a été créé et ce dossier contient <span class="hl">gulp-cssnano</span> et toutes les dépendances dont gulp-cssnano a besoin</p>
                    <p>Il y a toujours beaucoup trop de modules. Lorsque l'on souhaite partager un projet, il est préférable de ne pas partager ces modules</p>
                    <p>Sauf qu'il serait embêtant pour chaque développeur de devoir réinstaller chaque package</p>
                </section>

                <section>
                    <p>La solution : <span class="hl">package.json</span></p>
                    <p>C'est un fichier qu'on met en général à la racine du projet et qui contient divers informations. Parmi ces informations, peuvent se trouver les dépendances à installer.</p>
                    <p>NPM permet de créer ce fichier facilement</p>
                    <p>Depuis votre terminal, rendez vous dans le dossier de votre projet et lancez la commande suivante</p>
                    <pre><code data-trim contenteditable class="cpp">
npm init
                    </code></pre>
                    <p>Une série de question sont posées, les réponses n'ont que peu d'importance</p>
                </section>

                <section>
                    <p>Pour installer nos dépendances tout en les renseignant dans package.js, il suffit de rajouter --save (ou -S) à notre commande</p>
                    <pre><code data-trim contenteditable class="cpp">
npm install --save gulp-cssnano
                    </code></pre>
                    <p>Cela va installer le module dans node_modules (comme tout à l'heure), mais va aussi le rajouter dans package.json</p>
                </section>

                <section>
                    <p>Lorsque nous devons versionner le projet ou l'envoyer à un développeur, il ne faudra pas envoyer le dossier <span class="hl">node_modules</span>, mais il faudra bien inclure le fichier <span class="hl">package.json</span></p>
                </section>

                <section>
                    <p>Entant que développeur qui arrive sur le projet, pour installer les dépendances directement depuis le <span class="hl">package.json</span> il suffit de faire un <span class="hl">npm install</span> sans aucun autre paramètre</p>
                    <pre><code data-trim contenteditable class="cpp">
npm install
                    </code></pre>
                </section>

                <section>
                    <p>Régulièrement, NPM peut renvoyer une erreur s'il lui manque certains droits</p>
                    <p>Pour lui donner les droits, précédez les commandes par <span class="hl">sudo</span></p>
                    <pre><code data-trim contenteditable class="cpp">
sudo npm install
                    </code></pre>
                    <p>Cela aura pour effet de vous demander votre mot de passe</p>
                    <p><span class="hl">sudo</span> n'existe pas sur Windows</p>
                </section>

                <section>
                    <p>Il est possible d'installer un module globalement. Cela veut dire que la commande pour éxecuter le module pourra être appelé de n'importe où.</p>
                    <p>Pour cela, il suffit de rajouter -g en paramètre</p>
                    <pre><code data-trim contenteditable class="cpp">
sudo npm install -g keppler
                    </code></pre>
                </section>

                <section>
                    <p><a href="https://www.sitepoint.com/10-npm-tips-and-tricks/" target="_blank">Quelques astuces NPM</a></p>
                </section>

                <!-- GULP -->
                <section>
                    <h2>Gulp</h2>
                    <p>
                        <small>Enfin</small>
                    </p>
                </section>

                <section>
                    <p>Pour commencer, installons les commandes gulp</p>
                    <pre><code data-trim contenteditable class="cpp">
sudo npm install -g gulp-cli
                    </code></pre>
                </section>

                <section>
                    <p>Rajoutons gulp dans les dépendances du projet</p>
                    <pre><code data-trim contenteditable class="cpp">
sudo npm install --save gulp
                    </code></pre>
                </section>

                <section>
                    <p>Créez un fichier <span class="hl">gulpfile.js</span></p>
                    <pre><code data-trim contenteditable class="js">
var gulp = require( 'gulp' );

gulp.task( 'default', function()
{
    console.log( 'coucou' );
} );
                    </code></pre>
                </section>

                <section>
                    <p>Dans le terminal, éxecutez la commande suivante</p>
                    <pre><code data-trim contenteditable class="cpp">
gulp default
                    </code></pre>
                </section>

                <section>
                    <p>Si tout s'est bien passé :</p>
                    <img class="no-style" src="src/img/gulp-default.png" alt="" width="700">
                </section>

                <section>
                    <pre><code data-trim contenteditable class="js">
var gulp = require( 'gulp' );
                    </code></pre>
                    <p>Permet d'aller chercher gulp dans node_modules</p>
                    <p>Utilise <a href="http://browserify.org/" target="_blank">Browserify</a> et fait parti de Node JS</p>
                </section>

                <section>
                    <pre><code data-trim contenteditable class="js">
gulp.task( 'pwet', function()
{
    
} );
                    </code></pre>
                    <p>Permet de créer un tâche.<br>Le premier paramètre correspond au nom de la tâche qu'on pourra executer depuis le terminal</p>
                    <pre><code data-trim contenteditable class="js">
gulp pwet
                    </code></pre>
                </section>

                <section>
                    <p>Créons une tâche qui minimify le css</p>
                    <p>Nous allons avoir besoin des packages <span class="hl">gulp-cssnano</span> et <span class="hl">gulp-rename</span> en pensant bien à les rajouter au <span class="hl">package.json</span></p>
                    <pre><code data-trim contenteditable class="js">
sudo npm install --save gulp-cssnano gulp-rename
                    </code></pre>
                    <p>(Il est possible d'en installer plusieurs en même temps)</p>
                </section>

                <section>
                    <p>Créons une tâche <span class="hl">css</span> pour minimifier le css dans <span class="hl">gulpfile.js</span></p>
                    <pre><code data-trim contenteditable class="js">
// Dependencies
var gulp          = require( 'gulp' ),
    gulp_css_nano = require( 'gulp-cssnano' ),
    gulp_rename   = require( 'gulp-rename' );

// CSS task
gulp.task( 'css', function()
{
    return gulp.src( './src/css/style.css' )    // Get main CSS file
        .pipe( gulp_css_nano() )                // Minify it
        .pipe( gulp_rename( 'style.min.css' ) ) // Rename it
        .pipe( gulp.dest( './src/css/' ) );     // Put it in folder
} );
                    </code></pre>
                </section>

                <section>
                    <p>Créons une tâche <span class="hl">js</span> pour concatener les fichier js et les minimifier</p>
                    <pre><code data-trim contenteditable class="js">
// Dependencies
var gulp        = require( 'gulp' ),
    gulp_concat = require( 'gulp-concat' ),
    gulp_uglify = require( 'gulp-uglify' );

// JS task
gulp.task( 'js', function()
{
    return gulp.src( [                          // Get JS files (in order)
            './src/js/fastclick.js',
            './src/js/script.js'
        ] )
        .pipe( gulp_concat( 'script.min.js' ) ) // Concat in one file
        .pipe( gulp_uglify() )                  // Minify them
        .pipe( gulp.dest( './src/js/' ) );      // Put it in folder
} );
                    </code></pre>
                </section>

                <section>
                    <p>Ces tâches sont pratiques, mais on aimerait qu'elles se lancent automatiquement</p>
                    <p>Gulp intègre une fonctionnalité de surveillance des fichiers</p>
                    <p>Créons une tâche <span class="hl">watch</span></p>
                    <pre><code data-trim contenteditable class="js">
// Watch task
gulp.task( 'watch', function()
{
    // Watch for CSS modifications
    gulp.watch( './src/css/style.css', [ 'css' ] );

    // Watch for JS modifications (but not for script.min.js)
    gulp.watch( [ './src/js/**', '!./src/js/script.min.js' ], [ 'js' ] );
} );
                    </code></pre>
                </section>

                <section>
                    <p>Désormais, lorsqu'on lance la tâche <span class="hl">watch</span> le terminal continue d'éxecuter le watch et lance les tâche <span class="hl">css</span> ou <span class="hl">js</span></p>
                    <p>Pour arrêter la tâche <span class="hl">CTRL + C</span></p>
                </section>

                <section>
                    <p>Pour finir, nous pouvons créer une tâche par défaut qui s'occupe de lancer le <span class="hl">css</span>, le <span class="hl">js</span> et le <span class="hl">watch</span></p>
                    <pre><code data-trim contenteditable class="js">
gulp.task( 'default', [ 'css', 'js', 'watch' ] );
                    </code></pre>
                    <p>Le second paramètre d'une tâche peut être un tableau des différentes tâches à éxecuter</p>
                    <p>Si la tâche s'apelle <span class="hl">default</span> inutile de le spécifier dans le terminal</p>
                    <pre><code data-trim contenteditable class="cpp">
gulp
                    </code></pre>
                </section>

                <section>
                    <p>Nous n'avons vu là que des tâches de base peu complètes</p>
                    <p>Pour les améliorer, nous pourrions par exemple gérer les erreurs avec <a href="https://www.npmjs.com/package/gulp-plumber" target="_blank">Plumber</a>, gérer les sourcemaps avec <a href="https://www.npmjs.com/package/gulp-sourcemaps" target="_blank">Sourcemaps</a> et afficher une notification sur le desktop avec <a href="https://www.npmjs.com/package/gulp-notify" target="_blank">Notify</a></p>
                </section>

                <section>
                    <p>Quelques idées de tâches</p>
                    <ul>
                        <li>Compresser les images</li>
                        <li>Créer des sprites</li>
                        <li>Autopréfixer le CSS</li>
                        <li>Retirer toutes le CSS inutilez</li>
                        <li>Convertir du Sass ou Stylus en CSS</li>
                        <li>Transpiler de l'ES6 en ES5</li>
                        <li>Convertir des fichiers Pug (anciennement Jade) en HTML</li>
                        <li>Uploader automatiquement sur le FTP</li>
                        <li>Rafraichir automatiquement la page</li>
                    </ul>
                </section>

                <section>
                    <p>Les tasks runners font aujourd'hui parti de l'environnement de développement web</p>
                    <p>Gardez vos tâches simples et efficaces</p>
                    <p>N'oubliez pas de bien renseigner les dépendances dans package.json</p>
                </section>

            </div>
        </div>

        <script src="../src/reveal.js/lib/js/head.min.js"></script>
        <script src="../src/reveal.js/js/reveal.js"></script>
        <script src="../src/custom/script.js"></script>
    </body>
</html>
